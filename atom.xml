<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Poisoner&#39;s Blog</title>
  
  <subtitle>keep running</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://popwalker.github.io/"/>
  <updated>2018-05-08T15:27:39.407Z</updated>
  <id>https://popwalker.github.io/</id>
  
  <author>
    <name>poisoner</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用automator上传图片到腾讯云</title>
    <link href="https://popwalker.github.io/article/38b3f2da/"/>
    <id>https://popwalker.github.io/article/38b3f2da/</id>
    <published>2018-05-08T03:33:57.000Z</published>
    <updated>2018-05-08T15:27:39.407Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/53967ec46e216.jpg" alt=""></p><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>前段时间折腾了一下hexo博客，部署了<a href="https://popwalker.github.io/">Github Pages</a>，设置了自己的<a href="https://changxuefeng.com/" target="_blank" rel="noopener">域名</a>转发，添加了https，仿佛完事具备，只差写博客了。然而发现博客配图还是个问题，因为markdown添加图片的时候，我想使用cdn，而不是本地图片。</p><p>于是考察了一些可以作为图床的云服务商，比如<a href="https://www.qiniu.com/" target="_blank" rel="noopener">七牛</a>，<a href="https://sm.ms/" target="_blank" rel="noopener">sm.ms</a>，<a href="https://cloud.tencent.com/" target="_blank" rel="noopener">腾讯云</a> 。对比之后发现七牛不支持https，sm.ms完全免费，但功能似乎比较少，腾讯云的话有免费的几十G空间（具体多少我忘了）还提供https。嗯就用腾讯云吧。</p><a id="more"></a><p>图床选好了，那么上传图床的工具呢？都说iPic是个图床神器，最近还支持了腾讯云，不过需要付费。我需要的是一个免费版的，找了半天也没发现支持腾讯云的图床工具。作为一名coder，这怎么能忍？依稀记得好友的<a href="https://ultrarex.com/2017/09/12/use-Automator-upload-images-to-sm-ms-2/" target="_blank" rel="noopener">博客</a>中有写使用automator上传图片到sm.ms,于是我借鉴(copy)了一下，就有了本文。不同之处在于我这里使用的是腾讯云的<a href="https://cloud.tencent.com/document/product/436/12269" target="_blank" rel="noopener">python sdk</a>进行上传。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>使用automator上传图片的思路：</p><ul><li>点击本地图片，右键选择automator创建的服务</li><li>调用预先编写好的脚本进行上传</li><li>上传后将url写入剪贴板</li><li>在markdown编辑器中直接粘贴享用</li></ul><h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>打开automator，选择新建服务：</p><p><img src="https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/WX20180508-221120@2x.png" alt=""></p><p><img src="https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/WX20180508-221311@2x.png" alt=""></p><p>然后在“实用工具”中，找到“拷贝至剪切板”拖拽到右侧工作流程，这样，当我们选中图片的时候，就会将图片的本地路径设置到剪贴板中：</p><p><img src="https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/WX20180508-221716@2x.png" alt=""></p><p>我们需要在这个创建服务的过程中进行实际测试，因此可以将“获得指定的访达(finder)项目”这个使用工具添加到右侧的工作流中，放在顶部，并添加几张图片作为测试用（后面需要再删除的），如下图：</p><p><img src="https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/WX20180508-222121@2x.png" alt=""></p><p>然后点击右上角的运行按钮，运行完成后，查看自己的剪贴板内容，就会发现剪贴板内容正是图片的路径。</p><p>现在图片路径有了，再添加一个shell脚本的工作流，在脚本里面获取剪贴板里面的图片路径，然后进行上传，再将上传后的腾讯云的图片地址设置进剪贴板里，就行了。</p><p>将“运行shell脚本”这个工作流添加到右边，作为第三个工作流,并且选择python作为默认shell，如下图：</p><p><img src="https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/WX20180508-223140@2x.png" alt=""></p><p>上图中的python代码所做的事情就是上传图片，并设置剪贴板内容，code如下：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> qcloud_cos <span class="keyword">import</span> CosConfig</span><br><span class="line"><span class="keyword">from</span> qcloud_cos <span class="keyword">import</span> CosS3Client</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传腾讯云需要的相关配置，可在这里查看：https://console.cloud.tencent.com/cam/capi</span></span><br><span class="line">secret_id = <span class="string">'your_cos_secret_id'</span> <span class="comment"># 此处填入腾讯云的secret_id，</span></span><br><span class="line">secret_key = <span class="string">'your_cos_secret_key'</span> <span class="comment"># 此处填入腾讯云的secret_key</span></span><br><span class="line">app_id = <span class="string">'your_app_id'</span> <span class="comment"># 此处填入app_id</span></span><br><span class="line">region = <span class="string">'your_region'</span> <span class="comment"># 此处填入对象存储的地区</span></span><br><span class="line">token = <span class="string">''</span>  <span class="comment"># 使用临时秘钥需要传入 Token，默认为空，可不填</span></span><br><span class="line">bucket_name = <span class="string">'your_bucket_name'</span></span><br><span class="line">bucket = bucket_name + <span class="string">'-'</span> + app_id  <span class="comment"># Bucket由bucketname-appid组成</span></span><br><span class="line">legal_extensions = [<span class="string">'.jpg'</span>, <span class="string">'.jpeg'</span>, <span class="string">'.png'</span>, <span class="string">'gif'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取剪贴板内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getClipboardData</span><span class="params">()</span>:</span></span><br><span class="line">    p = subprocess.Popen([<span class="string">'pbpaste'</span>], stdout=subprocess.PIPE)</span><br><span class="line">    retcode = p.wait()</span><br><span class="line">    data = p.stdout.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置剪贴板内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setClipboardData</span><span class="params">(data)</span>:</span></span><br><span class="line">    p = subprocess.Popen([<span class="string">'pbcopy'</span>], stdin=subprocess.PIPE)</span><br><span class="line">    p.stdin.write(data)</span><br><span class="line">    p.stdin.close()</span><br><span class="line">    retcode = p.wait()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断扩展名是否合法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate_image</span><span class="params">(path)</span>:</span></span><br><span class="line">    extension = os.path.splitext(path)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> extension <span class="keyword">in</span> legal_extensions:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传至腾讯云</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(file_name, filepath)</span>:</span></span><br><span class="line">    config = CosConfig(Appid=app_id, Secret_id=secret_id, Secret_key=secret_key, Region=region, Token=token)</span><br><span class="line">    <span class="comment"># 获取客户端对象</span></span><br><span class="line">    client = CosS3Client(config)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(filepath, <span class="string">'rb'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        response = client.put_object(</span><br><span class="line">            Bucket=bucket,</span><br><span class="line">            Body=fp,</span><br><span class="line">            Key=file_name,</span><br><span class="line">            StorageClass=<span class="string">'STANDARD'</span>,</span><br><span class="line">            ContentType=<span class="string">'text/html; charset=utf-8'</span></span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># print response</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    contents = getClipboardData().split(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line">    uploaded_url = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> contents:</span><br><span class="line">        <span class="keyword">if</span> validate_image(path):</span><br><span class="line">            file_name = os.path.basename(path)</span><br><span class="line">            upload(file_name, path)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 拼接成markdown的image链接格式</span></span><br><span class="line">            uploaded_url += <span class="string">'![]('</span> + <span class="string">'https://'</span> + bucket + <span class="string">'.cos.'</span> + region + <span class="string">'.myqcloud.com/'</span> + file_name + <span class="string">")\n"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将url设置到剪贴板中</span></span><br><span class="line">    setClipboardData(uploaded_url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><p>代码量不多，其中上传函数<code>upload</code>的实现是使用的<a href="https://cloud.tencent.com/document/product/436/12269" target="_blank" rel="noopener">官方sdk</a>.如何安装sdk，以及更多使用方式，请参考官方文档</p><blockquote><p>tips: 这里运行的过程中不但可以单步调试，还可以查看程序输出，以便进行测试：</p></blockquote><p><img src="https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/WX20180508-230632@2x.png" alt=""></p><p>到这里上传功能已经实现了，如果再加一个上传完成后给个提示就更好了。</p><p>将“显示通知”这个工作流添加到右侧工作区，设置通知内容，然后执行，就会看到通知提示</p><p><img src="https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/WX20180508-224653@2x.png" alt=""></p><p>至此，功能已经实现，现在把第一个工作流“获取指定的finder项目”删除。保存这个服务，并取一个名字：</p><p><img src="https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/WX20180508-225049@2x.png" alt=""></p><p>然后随便找一个图片，右键呼出菜单，就会看到我们刚创建的服务，不出意外，就可以正常使用了：</p><p><img src="https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/WX20180508-225335@2x.png" alt=""></p><p>如果下次再想对这个服务进行编辑的话，该去哪里找呢？其实这些自定义的服务是放在<code>~/Library/Services</code>路径下的:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span> ls ~/Library/Services</span><br><span class="line">上传至腾讯云.workflow</span><br></pre></td></tr></table></figure><p>到这里，这个上传图片的automator就算完成了。不足之处就是只能对磁盘上的图片文件进行操作。无法对截图进行操作。其实理论上只要能获取剪贴板的内容，截图上传也是可以实现的。</p><p>参考：</p><ul><li><a href="https://ultrarex.com/2017/09/12/use-Automator-upload-images-to-sm-ms-2/" target="_blank" rel="noopener">使用 Automator 上传图片到 sm.ms</a></li><li><a href="https://cloud.tencent.com/document/product/436/12269" target="_blank" rel="noopener">腾讯云对象存储python sdk 文档</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://my-bucket-1254096302.cos.ap-guangzhou.myqcloud.com/53967ec46e216.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h3&gt;&lt;p&gt;前段时间折腾了一下hexo博客，部署了&lt;a href=&quot;https://popwalker.github.io/&quot;&gt;Github Pages&lt;/a&gt;，设置了自己的&lt;a href=&quot;https://changxuefeng.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;域名&lt;/a&gt;转发，添加了https，仿佛完事具备，只差写博客了。然而发现博客配图还是个问题，因为markdown添加图片的时候，我想使用cdn，而不是本地图片。&lt;/p&gt;
&lt;p&gt;于是考察了一些可以作为图床的云服务商，比如&lt;a href=&quot;https://www.qiniu.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;七牛&lt;/a&gt;，&lt;a href=&quot;https://sm.ms/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;sm.ms&lt;/a&gt;，&lt;a href=&quot;https://cloud.tencent.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;腾讯云&lt;/a&gt; 。对比之后发现七牛不支持https，sm.ms完全免费，但功能似乎比较少，腾讯云的话有免费的几十G空间（具体多少我忘了）还提供https。嗯就用腾讯云吧。&lt;/p&gt;
    
    </summary>
    
    
      <category term="automator" scheme="https://popwalker.github.io/tags/automator/"/>
    
      <category term="腾讯云" scheme="https://popwalker.github.io/tags/%E8%85%BE%E8%AE%AF%E4%BA%91/"/>
    
      <category term="mac" scheme="https://popwalker.github.io/tags/mac/"/>
    
      <category term="python" scheme="https://popwalker.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>hexo使用笔记</title>
    <link href="https://popwalker.github.io/article/d6ed9cc7/"/>
    <id>https://popwalker.github.io/article/d6ed9cc7/</id>
    <published>2018-04-25T01:56:14.000Z</published>
    <updated>2018-04-25T14:55:14.000Z</updated>
    
    <content type="html"><![CDATA[<center><br><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="https://music.163.com/outchain/player?type=2&id=432506345&auto=0&height=66"></iframe><br></center><h3 id="添加阅读次数统计"><a href="#添加阅读次数统计" class="headerlink" title="添加阅读次数统计"></a>添加阅读次数统计</h3><blockquote><p>参考next主题文档，使用leanCloud来统计</p></blockquote><p>1.注册<a href="https://leancloud.cn/" target="_blank" rel="noopener">leancloud</a>账号，获取<code>appId</code>和<code>appKey</code>,具体细节可以参考<a href="https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud" target="_blank" rel="noopener">这里</a></p><p>2.编辑<code>主题配置文件</code>，修改配项<code>leancloud_visitors</code></p><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">leancloud_visitors:</span><br><span class="line">  enable: true</span><br><span class="line">  app_id: &lt;your_app_id&gt;</span><br><span class="line">  app_key: &lt;your_app_key&gt;</span><br><span class="line">  security: true</span><br><span class="line">  betterPerformance: false</span><br></pre></td></tr></table></figure><p>然后重新部署hexo博客，列表页已经有了阅读次数，但是详情页报错：<code>阅读次数： Counter not initialized! See more at console err msg.</code><br>查看控制台报错，有两种方式解决：</p><ul><li>使用<code>hexo-leancloud-counter-security</code>插件</li><li>设置<code>leancloud_visitors.security = false</code></li></ul><p>我这里选择第二种。设置以后重新部署hexo，即可看到阅读次数的统计。 </p><h3 id="添加音乐"><a href="#添加音乐" class="headerlink" title="添加音乐"></a>添加音乐</h3><p>添加音乐很简单，只需要在markdown文件中加入iframe标签即可，示例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">frameborder</span>=<span class="string">"no"</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">marginwidth</span>=<span class="string">"0"</span> <span class="attr">marginheight</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">330</span> <span class="attr">height</span>=<span class="string">86</span> <span class="attr">src</span>=<span class="string">"http://music.163.com/outchain/player?type=2&amp;id=34578162&amp;auto=0&amp;height=66"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后需要做的就是将上面链接中的id的值替换成目标歌曲的id即可，可以去网易云音乐搜索音乐，从链接中获取id。更多玩法参考<a href="http://frankorz.com/2016/09/30/Hexo-patch/#添加音乐" target="_blank" rel="noopener">这里</a></p><p>参考：</p><ul><li><a href="https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud" target="_blank" rel="noopener">为NexT主题添加文章阅读量统计功能</a></li><li><a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">NexT官方文档</a></li><li><a href="http://frankorz.com/2016/09/30/Hexo-patch" target="_blank" rel="noopener">Hexo 博客补丁</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;center&gt;&lt;br&gt;&lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=&quot;330&quot; height=&quot;86&quot; src=&quot;https://music.163.com/outchain/player?type=2&amp;id=432506345&amp;auto=0&amp;height=66&quot;&gt;&lt;/iframe&gt;&lt;br&gt;&lt;/center&gt;




&lt;h3 id=&quot;添加阅读次数统计&quot;&gt;&lt;a href=&quot;#添加阅读次数统计&quot; class=&quot;headerlink&quot; title=&quot;添加阅读次数统计&quot;&gt;&lt;/a&gt;添加阅读次数统计&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;参考next主题文档，使用leanCloud来统计&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;1.注册&lt;a href=&quot;https://leancloud.cn/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;leancloud&lt;/a&gt;账号，获取&lt;code&gt;appId&lt;/code&gt;和&lt;code&gt;appKey&lt;/code&gt;,具体细节可以参考&lt;a href=&quot;https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2.编辑&lt;code&gt;主题配置文件&lt;/code&gt;，修改配项&lt;code&gt;leancloud_visitors&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="https://popwalker.github.io/tags/hexo/"/>
    
  </entry>
  
</feed>
